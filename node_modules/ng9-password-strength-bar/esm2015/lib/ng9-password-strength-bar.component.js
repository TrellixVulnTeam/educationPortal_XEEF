var Ng9PasswordStrengthBarComponent_1;
import { __decorate } from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
let Ng9PasswordStrengthBarComponent = Ng9PasswordStrengthBarComponent_1 = class Ng9PasswordStrengthBarComponent {
    constructor() {
        this.onStrengthChanged = new EventEmitter();
        this.defaultColors = ['#F00', '#F90', '#FF0', '#9F0', '#0F0'];
        this.defaultThresholds = [90, 70, 40, 20];
        this.defaultBaseColor = '#DDD';
        this.colors = this.defaultColors;
        this.thresholds = this.defaultThresholds;
    }
    static measureStrength(pass) {
        let score = 0;
        // award every unique letter until 5 repetitions
        const letters = {};
        for (let i = 0; i < pass.length; i++) {
            letters[pass[i]] = (letters[pass[i]] || 0) + 1;
            score += 5.0 / letters[pass[i]];
        }
        // bonus points for mixing it up
        const variations = {
            digits: /\d/.test(pass),
            lower: /[a-z]/.test(pass),
            upper: /[A-Z]/.test(pass),
            nonWords: /\W/.test(pass),
        };
        let variationCount = 0;
        for (let check in variations) {
            variationCount += (variations[check]) ? 1 : 0;
        }
        score += (variationCount - 1) * 10;
        return Math.trunc(score);
    }
    checkBarColors() {
        // Accept custom colors if input is valid, otherwise the default colors will be used
        if (this.barColors && this.barColors.length === 5) {
            this.colors = this.barColors.slice();
        }
        else {
            this.colors = this.defaultColors;
        }
        this.strengths = this.strengthLabels && this.strengthLabels.length === 5 ? this.strengthLabels.slice() : null;
        this.setStrengthLabel(0);
        if (!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(this.baseColor)) {
            this.baseColor = this.defaultBaseColor;
        }
    }
    checkThresholds() {
        if (this.customThresholds && this.customThresholds.length === 4) {
            this.thresholds = this.customThresholds.slice();
        }
        else {
            this.thresholds = this.defaultThresholds;
        }
    }
    getColor(score) {
        let idx = 0;
        if (score > this.thresholds[0]) {
            idx = 4;
        }
        else if (score > this.thresholds[1]) {
            idx = 3;
        }
        else if (score >= this.thresholds[2]) {
            idx = 2;
        }
        else if (score >= this.thresholds[3]) {
            idx = 1;
        }
        return {
            idx: idx + 1,
            col: this.colors[idx]
        };
    }
    getStrengthIndexAndColor(password) {
        return this.getColor(Ng9PasswordStrengthBarComponent_1.measureStrength(password));
    }
    ngOnChanges(changes) {
        if (!changes['passwordToCheck']) {
            return;
        }
        const password = changes['passwordToCheck'].currentValue;
        this.checkBarColors();
        this.checkThresholds();
        this.setBarColors(5, this.baseColor);
        let strength = 0;
        if (password) {
            const c = this.getStrengthIndexAndColor(password);
            strength = c.idx - 1;
            this.setStrengthLabel(strength);
            this.setBarColors(c.idx, c.col);
        }
        this.onStrengthChanged.emit(strength);
    }
    setBarColors(count, col) {
        for (let _n = 0; _n < count; _n++) {
            this['bar' + _n] = col;
        }
    }
    setStrengthLabel(index) {
        if (this.strengths) {
            this.strengthLabel = this.strengths[index];
        }
    }
};
__decorate([
    Input()
], Ng9PasswordStrengthBarComponent.prototype, "passwordToCheck", void 0);
__decorate([
    Input()
], Ng9PasswordStrengthBarComponent.prototype, "barLabel", void 0);
__decorate([
    Input()
], Ng9PasswordStrengthBarComponent.prototype, "barColors", void 0);
__decorate([
    Input()
], Ng9PasswordStrengthBarComponent.prototype, "baseColor", void 0);
__decorate([
    Input()
], Ng9PasswordStrengthBarComponent.prototype, "strengthLabels", void 0);
__decorate([
    Input()
], Ng9PasswordStrengthBarComponent.prototype, "customThresholds", void 0);
__decorate([
    Output()
], Ng9PasswordStrengthBarComponent.prototype, "onStrengthChanged", void 0);
Ng9PasswordStrengthBarComponent = Ng9PasswordStrengthBarComponent_1 = __decorate([
    Component({
        selector: 'ng9-password-strength-bar',
        template: `
    <div id="strength" #strength>
      <small>{{barLabel}}</small>
      <ul id="strengthBar" class="strengthBar">
        <li id="bar0" class="point" [style.background-color]="bar0"></li>
        <li class="point" [style.background-color]="bar1"></li>
        <li class="point" [style.background-color]="bar2"></li>
        <li class="point" [style.background-color]="bar3"></li>
        <li class="point" [style.background-color]="bar4"></li>
      </ul>
      <small [hidden]="!strengths" class="pre">  {{strengthLabel}}</small>
    </div>
  `,
        styles: [`
    .strengthBar {
      display: inline;
      list-style: none;
      margin: 0 0 0 15px;
      padding: 0;
      vertical-align: 2px;
    }

    .strengthBar .point {
      background: #DDD;
      border-radius: 2px;
      display: inline-block;
      height: 5px;
      margin-right: 1px;
      width: 20px;
    }

    .strengthBar .point:last-child {
      margin: 0;
    }
    .pre {
      white-space: pre;
    }
  `]
    })
], Ng9PasswordStrengthBarComponent);
export { Ng9PasswordStrengthBarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmc5LXBhc3N3b3JkLXN0cmVuZ3RoLWJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiL2hvbWUvYm9iL1Byb2plY3RzL25nOS1wYXNzd29yZC1zdHJlbmd0aC1iYXIvcHJvamVjdHMvbmc5LXBhc3N3b3JkLXN0cmVuZ3RoLWJhci9zcmMvIiwic291cmNlcyI6WyJsaWIvbmc5LXBhc3N3b3JkLXN0cmVuZ3RoLWJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFhLEtBQUssRUFBZ0IsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQTJDaEcsSUFBYSwrQkFBK0IsdUNBQTVDLE1BQWEsK0JBQStCO0lBZ0QxQztRQXpDVSxzQkFBaUIsR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQWF2RSxrQkFBYSxHQUFHLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3pELHNCQUFpQixHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDckMscUJBQWdCLEdBQUcsTUFBTSxDQUFDO1FBMkJoQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDakMsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7SUFDM0MsQ0FBQztJQTNCTyxNQUFNLENBQUMsZUFBZSxDQUFDLElBQVk7UUFDekMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsZ0RBQWdEO1FBQ2hELE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNuQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNwQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxD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RUFBRSxFQUFFLEVBQUUsRUFBRTtZQUNqQyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQztTQUN4QjtJQUNILENBQUM7SUFDTyxnQkFBZ0IsQ0FBQyxLQUFhO1FBQ3BDLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDNUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQTdIVTtJQUFSLEtBQUssRUFBRTt3RUFBeUI7QUFDeEI7SUFBUixLQUFLLEVBQUU7aUVBQWtCO0FBQ2pCO0lBQVIsS0FBSyxFQUFFO2tFQUEwQjtBQUN6QjtJQUFSLEtBQUssRUFBRTtrRUFBbUI7QUFDbEI7SUFBUixLQUFLLEVBQUU7dUVBQStCO0FBQzlCO0lBQVIsS0FBSyxFQUFFO3lFQUFpQztBQUMvQjtJQUFULE1BQU0sRUFBRTswRUFBc0U7QUFQcEUsK0JBQStCO0lBekMzQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsMkJBQTJCO1FBMEJyQyxRQUFRLEVBQUU7Ozs7Ozs7Ozs7OztHQVlUO2lCQXJDUTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBd0JSO0tBY0YsQ0FBQztHQUNXLCtCQUErQixDQThIM0M7U0E5SFksK0JBQStCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkNoYW5nZXMsIElucHV0LCBTaW1wbGVDaGFuZ2UsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25nOS1wYXNzd29yZC1zdHJlbmd0aC1iYXInLFxuICBzdHlsZXM6IFtgXG4gICAgLnN0cmVuZ3RoQmFyIHtcbiAgICAgIGRpc3BsYXk6IGlubGluZTtcbiAgICAgIGxpc3Qtc3R5bGU6IG5vbmU7XG4gICAgICBtYXJnaW46IDAgMCAwIDE1cHg7XG4gICAgICBwYWRkaW5nOiAwO1xuICAgICAgdmVydGljYWwtYWxpZ246IDJweDtcbiAgICB9XG5cbiAgICAuc3RyZW5ndGhCYXIgLnBvaW50IHtcbiAgICAgIGJhY2tncm91bmQ6ICNEREQ7XG4gICAgICBib3JkZXItcmFkaXVzOiAycHg7XG4gICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICBoZWlnaHQ6IDVweDtcbiAgICAgIG1hcmdpbi1yaWdodDogMXB4O1xuICAgICAgd2lkdGg6IDIwcHg7XG4gICAgfVxuXG4gICAgLnN0cmVuZ3RoQmFyIC5wb2ludDpsYXN0LWNoaWxkIHtcbiAgICAgIG1hcmdpbjogMDtcbiAgICB9XG4gICAgLnByZSB7XG4gICAgICB3aGl0ZS1zcGFjZTogcHJlO1xuICAgIH1cbiAgYF0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBpZD1cInN0cmVuZ3RoXCIgI3N0cmVuZ3RoPlxuICAgICAgPHNtYWxsPnt7YmFyTGFiZWx9fTwvc21hbGw+XG4gICAgICA8dWwgaWQ9XCJzdHJlbmd0aEJhclwiIGNsYXNzPVwic3RyZW5ndGhCYXJcIj5cbiAgICAgICAgPGxpIGlkPVwiYmFyMFwiIGNsYXNzPVwicG9pbnRcIiBbc3R5bGUuYmFja2dyb3VuZC1jb2xvcl09XCJiYXIwXCI+PC9saT5cbiAgICAgICAgPGxpIGNsYXNzPVwicG9pbnRcIiBbc3R5bGUuYmFja2dyb3VuZC1jb2xvcl09XCJiYXIxXCI+PC9saT5cbiAgICAgICAgPGxpIGNsYXNzPVwicG9pbnRcIiBbc3R5bGUuYmFja2dyb3VuZC1jb2xvcl09XCJiYXIyXCI+PC9saT5cbiAgICAgICAgPGxpIGNsYXNzPVwicG9pbnRcIiBbc3R5bGUuYmFja2dyb3VuZC1jb2xvcl09XCJiYXIzXCI+PC9saT5cbiAgICAgICAgPGxpIGNsYXNzPVwicG9pbnRcIiBbc3R5bGUuYmFja2dyb3VuZC1jb2xvcl09XCJiYXI0XCI+PC9saT5cbiAgICAgIDwvdWw+XG4gICAgICA8c21hbGwgW2hpZGRlbl09XCIhc3RyZW5ndGhzXCIgY2xhc3M9XCJwcmVcIj4gIHt7c3RyZW5ndGhMYWJlbH19PC9zbWFsbD5cbiAgICA8L2Rpdj5cbiAgYFxufSlcbmV4cG9ydCBjbGFzcyBOZzlQYXNzd29yZFN0cmVuZ3RoQmFyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgQElucHV0KCkgcGFzc3dvcmRUb0NoZWNrOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGJhckxhYmVsOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGJhckNvbG9yczogQXJyYXk8c3RyaW5nPjtcbiAgQElucHV0KCkgYmFzZUNvbG9yOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHN0cmVuZ3RoTGFiZWxzOiBBcnJheTxzdHJpbmc+O1xuICBASW5wdXQoKSBjdXN0b21UaHJlc2hvbGRzOiBBcnJheTxudW1iZXI+O1xuICBAT3V0cHV0KCkgb25TdHJlbmd0aENoYW5nZWQ6IEV2ZW50RW1pdHRlcjxudW1iZXI+ID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgYmFyMDogc3RyaW5nO1xuICBiYXIxOiBzdHJpbmc7XG4gIGJhcjI6IHN0cmluZztcbiAgYmFyMzogc3RyaW5nO1xuICBiYXI0OiBzdHJpbmc7XG5cbiAgc3RyZW5ndGhMYWJlbDogc3RyaW5nO1xuXG4gIHByaXZhdGUgY29sb3JzOiBBcnJheTxzdHJpbmc+O1xuICBwcml2YXRlIHRocmVzaG9sZHM6IEFycmF5PG51bWJlcj47XG4gIHN0cmVuZ3RoczogQXJyYXk8c3RyaW5nPjtcbiAgcHJpdmF0ZSBkZWZhdWx0Q29sb3JzID0gWycjRjAwJywgJyNGOTAnLCAnI0ZGMCcsICcjOUYwJywgJyMwRjAnXTtcbiAgcHJpdmF0ZSBkZWZhdWx0VGhyZXNob2xkcyA9IFs5MCwgNzAsIDQwLCAyMF07XG4gIHByaXZhdGUgZGVmYXVsdEJhc2VDb2xvciA9ICcjREREJztcblxuICBwcml2YXRlIHN0YXRpYyBtZWFzdXJlU3RyZW5ndGgocGFzczogc3RyaW5nKSB7XG4gICAgbGV0IHNjb3JlID0gMDtcbiAgICAvLyBhd2FyZCBldmVyeSB1bmlxdWUgbGV0dGVyIHVudGlsIDUgcmVwZXRpdGlvbnNcbiAgICBjb25zdCBsZXR0ZXJzID0ge307XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXR0ZXJzW3Bhc3NbaV1dID0gKGxldHRlcnNbcGFzc1tpXV0gfHwgMCkgKyAxO1xuICAgICAgc2NvcmUgKz0gNS4wIC8gbGV0dGVyc1twYXNzW2ldXTtcbiAgICB9XG4gICAgLy8gYm9udXMgcG9pbnRzIGZvciBtaXhpbmcgaXQgdXBcbiAgICBjb25zdCB2YXJpYXRpb25zID0ge1xuICAgICAgZGlnaXRzOiAvXFxkLy50ZXN0KHBhc3MpLFxuICAgICAgbG93ZXI6IC9bYS16XS8udGVzdChwYXNzKSxcbiAgICAgIHVwcGVyOiAvW0EtWl0vLnRlc3QocGFzcyksXG4gICAgICBub25Xb3JkczogL1xcVy8udGVzdChwYXNzKSxcbiAgICB9O1xuXG4gICAgbGV0IHZhcmlhdGlvbkNvdW50ID0gMDtcbiAgICBmb3IgKGxldCBjaGVjayBpbiB2YXJpYXRpb25zKSB7XG4gICAgICB2YXJpYXRpb25Db3VudCArPSAodmFyaWF0aW9uc1tjaGVja10pID8gMSA6IDA7XG4gICAgfVxuICAgIHNjb3JlICs9ICh2YXJpYXRpb25Db3VudCAtIDEpICogMTA7XG4gICAgcmV0dXJuIE1hdGgudHJ1bmMoc2NvcmUpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb2xvcnMgPSB0aGlzLmRlZmF1bHRDb2xvcnM7XG4gICAgdGhpcy50aHJlc2hvbGRzID0gdGhpcy5kZWZhdWx0VGhyZXNob2xkcztcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tCYXJDb2xvcnMoKTogdm9pZCB7XG4gICAgLy8gQWNjZXB0IGN1c3RvbSBjb2xvcnMgaWYgaW5wdXQgaXMgdmFsaWQsIG90aGVyd2lzZSB0aGUgZGVmYXVsdCBjb2xvcnMgd2lsbCBiZSB1c2VkXG4gICAgaWYgKHRoaXMuYmFyQ29sb3JzICYmIHRoaXMuYmFyQ29sb3JzLmxlbmd0aCA9PT0gNSkge1xuICAgICAgdGhpcy5jb2xvcnMgPSB0aGlzLmJhckNvbG9ycy5zbGljZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbG9ycyA9IHRoaXMuZGVmYXVsdENvbG9ycztcbiAgICB9XG5cbiAgICB0aGlzLnN0cmVuZ3RocyA9IHRoaXMuc3RyZW5ndGhMYWJlbHMgJiYgdGhpcy5zdHJlbmd0aExhYmVscy5sZW5ndGggPT09IDUgPyB0aGlzLnN0cmVuZ3RoTGFiZWxzLnNsaWNlKCkgOiBudWxsO1xuICAgIHRoaXMuc2V0U3RyZW5ndGhMYWJlbCgwKTtcblxuICAgIGlmICghLyheI1swLTlBLUZdezZ9JCl8KF4jWzAtOUEtRl17M30kKS9pLnRlc3QodGhpcy5iYXNlQ29sb3IpKSB7XG4gICAgICB0aGlzLmJhc2VDb2xvciA9IHRoaXMuZGVmYXVsdEJhc2VDb2xvcjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNrVGhyZXNob2xkcygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jdXN0b21UaHJlc2hvbGRzICYmIHRoaXMuY3VzdG9tVGhyZXNob2xkcy5sZW5ndGggPT09IDQpIHtcbiAgICAgIHRoaXMudGhyZXNob2xkcyA9IHRoaXMuY3VzdG9tVGhyZXNob2xkcy5zbGljZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRocmVzaG9sZHMgPSB0aGlzLmRlZmF1bHRUaHJlc2hvbGRzO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sb3Ioc2NvcmU6IG51bWJlcikge1xuICAgIGxldCBpZHggPSAwO1xuICAgIGlmIChzY29yZSA+IHRoaXMudGhyZXNob2xkc1swXSkge1xuICAgICAgaWR4ID0gNDtcbiAgICB9IGVsc2UgaWYgKHNjb3JlID4gdGhpcy50aHJlc2hvbGRzWzFdKSB7XG4gICAgICBpZHggPSAzO1xuICAgIH0gZWxzZSBpZiAoc2NvcmUgPj0gdGhpcy50aHJlc2hvbGRzWzJdKSB7XG4gICAgICBpZHggPSAyO1xuICAgIH0gZWxzZSBpZiAoc2NvcmUgPj0gdGhpcy50aHJlc2hvbGRzWzNdKSB7XG4gICAgICBpZHggPSAxO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgaWR4OiBpZHggKyAxLFxuICAgICAgY29sOiB0aGlzLmNvbG9yc1tpZHhdXG4gICAgfTtcbiAgfVxuXG4gIGdldFN0cmVuZ3RoSW5kZXhBbmRDb2xvcihwYXNzd29yZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3IoTmc5UGFzc3dvcmRTdHJlbmd0aEJhckNvbXBvbmVudC5tZWFzdXJlU3RyZW5ndGgocGFzc3dvcmQpKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IHsgW3Byb3BOYW1lOiBzdHJpbmddOiBTaW1wbGVDaGFuZ2UgfSk6IHZvaWQge1xuICAgIGlmICghY2hhbmdlc1sncGFzc3dvcmRUb0NoZWNrJ10pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcGFzc3dvcmQgPSBjaGFuZ2VzWydwYXNzd29yZFRvQ2hlY2snXS5jdXJyZW50VmFsdWU7XG4gICAgdGhpcy5jaGVja0JhckNvbG9ycygpO1xuICAgIHRoaXMuY2hlY2tUaHJlc2hvbGRzKCk7XG4gICAgdGhpcy5zZXRCYXJDb2xvcnMoNSwgdGhpcy5iYXNlQ29sb3IpO1xuICAgIGxldCBzdHJlbmd0aCA9IDA7XG4gICAgaWYgKHBhc3N3b3JkKSB7XG4gICAgICBjb25zdCBjID0gdGhpcy5nZXRTdHJlbmd0aEluZGV4QW5kQ29sb3IocGFzc3dvcmQpO1xuICAgICAgc3RyZW5ndGggPSBjLmlkeCAtIDE7XG4gICAgICB0aGlzLnNldFN0cmVuZ3RoTGFiZWwoc3RyZW5ndGgpO1xuICAgICAgdGhpcy5zZXRCYXJDb2xvcnMoYy5pZHgsIGMuY29sKTtcbiAgICB9XG4gICAgdGhpcy5vblN0cmVuZ3RoQ2hhbmdlZC5lbWl0KHN0cmVuZ3RoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QmFyQ29sb3JzKGNvdW50OiBudW1iZXIsIGNvbDogc3RyaW5nKSB7XG4gICAgZm9yIChsZXQgX24gPSAwOyBfbiA8IGNvdW50OyBfbisrKSB7XG4gICAgICB0aGlzWydiYXInICsgX25dID0gY29sO1xuICAgIH1cbiAgfVxuICBwcml2YXRlIHNldFN0cmVuZ3RoTGFiZWwoaW5kZXg6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnN0cmVuZ3Rocykge1xuICAgICAgdGhpcy5zdHJlbmd0aExhYmVsID0gdGhpcy5zdHJlbmd0aHNbaW5kZXhdO1xuICAgIH1cbiAgfVxufVxuIl19